{% extends 'ctf/ctf_home.html' %}

{% block title %}Reyting // Leaderboard{% endblock %}

{% block content %}
<style>
    :root {
        --neon-gold: #fbbf24;
        --neon-silver: #94a3b8;
        --neon-bronze: #b45309;
        --glass-bg: rgba(15, 23, 42, 0.6);
        --glass-border: rgba(255, 255, 255, 0.1);
    }

    /* Podium Layout */
    .podium-section {
        display: flex;
        justify-content: center;
        align-items: flex-end;
        gap: 1.5rem;
        margin-bottom: 4rem;
        perspective: 1000px;
        padding-top: 2rem;
    }

    .podium-card {
        background: var(--glass-bg);
        backdrop-filter: blur(10px);
        border: 1px solid var(--glass-border);
        border-radius: 1rem;
        padding: 1.5rem;
        display: flex;
        flex-direction: column;
        align-items: center;
        position: relative;
        transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1), box-shadow 0.3s ease;
        cursor: pointer;
    }

    .podium-card:hover {
        transform: translateY(-10px) scale(1.02);
        z-index: 10;
    }

    /* Avatar Styles */
    .podium-avatar-wrapper {
        position: relative;
        margin-bottom: 1rem;
    }

    .podium-avatar {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        object-fit: cover;
        border: 3px solid transparent;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
    }

    .crown-icon {
        position: absolute;
        top: -25px;
        left: 50%;
        transform: translateX(-50%);
        font-size: 1.5rem;
        filter: drop-shadow(0 0 5px rgba(251, 191, 36, 0.8));
        animation: float 3s ease-in-out infinite;
    }

    /* Rank Specifics */
    .rank-1-card {
        order: 2;
        width: 220px;
        padding-bottom: 3rem;
        background: linear-gradient(180deg, rgba(251, 191, 36, 0.1) 0%, rgba(0, 0, 0, 0) 100%);
        border-color: rgba(251, 191, 36, 0.3);
        box-shadow: 0 0 30px rgba(251, 191, 36, 0.1);
        z-index: 5;
    }

    .rank-1-card .podium-avatar {
        width: 110px;
        height: 110px;
        border-color: var(--neon-gold);
        box-shadow: 0 0 25px rgba(251, 191, 36, 0.3);
    }

    .rank-1-card:hover {
        box-shadow: 0 0 50px rgba(251, 191, 36, 0.2);
    }

    .rank-2-card {
        order: 1;
        width: 180px;
        padding-bottom: 2rem;
        background: linear-gradient(180deg, rgba(148, 163, 184, 0.1) 0%, rgba(0, 0, 0, 0) 100%);
        border-color: rgba(148, 163, 184, 0.3);
    }

    .rank-2-card .podium-avatar {
        border-color: var(--neon-silver);
        box-shadow: 0 0 20px rgba(148, 163, 184, 0.3);
    }

    .rank-3-card {
        order: 3;
        width: 180px;
        padding-bottom: 1.5rem;
        background: linear-gradient(180deg, rgba(180, 83, 9, 0.1) 0%, rgba(0, 0, 0, 0) 100%);
        border-color: rgba(180, 83, 9, 0.3);
    }

    .rank-3-card .podium-avatar {
        border-color: var(--neon-bronze);
        box-shadow: 0 0 20px rgba(180, 83, 9, 0.3);
    }

    /* Rank Badge */
    .rank-badge {
        position: absolute;
        bottom: -15px;
        background: #0f172a;
        padding: 5px 15px;
        border-radius: 999px;
        border: 1px solid;
        font-family: 'Orbitron', sans-serif;
        font-weight: bold;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
    }

    .username-glow {
        text-shadow: 0 0 10px currentColor;
    }

    /* Animations */
    @keyframes float {

        0%,
        100% {
            transform: translateX(-50%) translateY(0);
        }

        50% {
            transform: translateX(-50%) translateY(-10px);
        }
    }

    /* Table Enhancements */
    .cyber-table-container {
        background: rgba(0, 0, 0, 0.4);
        border: 1px solid rgba(255, 255, 255, 0.05);
        border-radius: 1rem;
        overflow: hidden;
        backdrop-filter: blur(5px);
    }

    .cyber-table th {
        background: rgba(255, 255, 255, 0.02);
        letter-spacing: 1px;
    }

    .rank-cell {
        font-family: 'Orbitron', sans-serif;
        font-weight: bold;
    }

    @media (max-width: 768px) {
        .podium-section {
            flex-direction: column;
            align-items: center;
            gap: 2rem;
        }

        .rank-1-card {
            order: 1;
            width: 100%;
            max-width: 280px;
        }

        .rank-2-card {
            order: 2;
            width: 100%;
            max-width: 280px;
        }

        .rank-3-card {
            order: 3;
            width: 100%;
            max-width: 280px;
        }
    }
</style>

<div class="max-w-6xl mx-auto px-4 py-8 pt-32 min-h-screen">

    <div class="text-center mb-12">
        <h1 class="text-4xl md:text-5xl font-bold text-white tracking-wider font-display mb-2"
            style="font-family: 'Orbitron', sans-serif;">
            TOP <span class="text-transparent bg-clip-text bg-gradient-to-r from-emerald-400 to-cyan-400">HACKERS</span>
        </h1>
        <p class="text-slate-500 font-mono text-sm tracking-widest">>>> ELITE_OPERATIVES_RANKING</p>
    </div>

    <!-- Podium Section (Only on Page 1) -->
    {% if page_obj.number == 1 and page_obj|length > 0 %}
    <div class="podium-section">

        <!-- Rank 2 -->
        <div class="podium-card rank-2-card {% if page_obj|length < 2 %}invisible{% endif %}">
            {% if page_obj|length >= 2 %}
            <div class="podium-avatar-wrapper">
                {% if page_obj.1.avatar %}
                <img src="{{ page_obj.1.avatar.url }}" class="podium-avatar">
                {% else %}
                <div
                    class="podium-avatar bg-slate-800 flex items-center justify-center text-2xl font-mono text-slate-500">
                    {{ page_obj.1.user.username|slice:":1" }}
                </div>
                {% endif %}
                <div class="rank-badge text-slate-300 border-slate-500">2</div>
            </div>
            <div class="text-center mt-2">
                <div class="font-bold text-slate-200 text-lg truncate w-full px-2">{{ page_obj.1.user.username }}</div>
                <div class="font-mono text-emerald-400 font-bold">{{ page_obj.1.total_points }} PTS</div>
            </div>
            {% endif %}
        </div>

        <!-- Rank 1 -->
        <div class="podium-card rank-1-card">
            {% if page_obj|length >= 1 %}
            <div class="podium-avatar-wrapper">
                <i class="fas fa-crown crown-icon text-yellow-400"></i>
                {% if page_obj.0.avatar %}
                <img src="{{ page_obj.0.avatar.url }}" class="podium-avatar">
                {% else %}
                <div
                    class="podium-avatar bg-slate-800 flex items-center justify-center text-4xl font-mono text-slate-500">
                    {{ page_obj.0.user.username|slice:":1" }}
                </div>
                {% endif %}
                <div class="rank-badge text-yellow-400 border-yellow-500 px-4 scale-110">1</div>
            </div>
            <div class="text-center mt-4">
                <div class="font-bold text-white text-xl truncate w-full px-2 username-glow">{{ page_obj.0.user.username
                    }}</div>
                <div class="font-mono text-emerald-400 text-lg font-bold mt-1">{{ page_obj.0.total_points }} PTS</div>
                <div class="text-xs text-slate-500 mt-2 font-mono">LEGEND</div>
            </div>
            {% endif %}
        </div>

        <!-- Rank 3 -->
        <div class="podium-card rank-3-card {% if page_obj|length < 3 %}invisible{% endif %}">
            {% if page_obj|length >= 3 %}
            <div class="podium-avatar-wrapper">
                {% if page_obj.2.avatar %}
                <img src="{{ page_obj.2.avatar.url }}" class="podium-avatar">
                {% else %}
                <div
                    class="podium-avatar bg-slate-800 flex items-center justify-center text-2xl font-mono text-slate-500">
                    {{ page_obj.2.user.username|slice:":1" }}
                </div>
                {% endif %}
                <div class="rank-badge text-orange-400 border-orange-500">3</div>
            </div>
            <div class="text-center mt-2">
                <div class="font-bold text-slate-200 text-lg truncate w-full px-2">{{ page_obj.2.user.username }}</div>
                <div class="font-mono text-emerald-400 font-bold">{{ page_obj.2.total_points }} PTS</div>
            </div>
            {% endif %}
        </div>

    </div>
    {% endif %}

    <!-- Data Table -->
    <div class="cyber-table-container">
        <table class="w-full text-left border-collapse cyber-table">
            <thead>
                <tr class="text-slate-500 font-mono text-xs uppercase border-b border-white/5">
                    <th class="px-6 py-4 w-20 text-center">#</th>
                    <th class="px-6 py-4">Operative</th>
                    <th class="px-6 py-4 text-right">Score</th>
                    <th class="px-6 py-4 text-right hidden md:table-cell">Details</th>
                </tr>
            </thead>
            <tbody class="divide-y divide-white/5 text-sm font-mono text-slate-300">
                {% for profile in page_obj %}
                {% if page_obj.number != 1 or forloop.counter > 3 %}
                <tr class="hover:bg-white/[0.02] transition-colors group">
                    <td class="px-6 py-4 text-center rank-cell text-slate-500 group-hover:text-emerald-500">
                        {{ page_obj.start_index|add:forloop.counter0 }}
                    </td>
                    <td class="px-6 py-4">
                        <div class="flex items-center gap-3">
                            <div
                                class="w-8 h-8 rounded bg-white/5 flex items-center justify-center overflow-hidden border border-white/10 group-hover:border-emerald-500/50 transition-colors">
                                {% if profile.avatar %}
                                <img src="{{ profile.avatar.url }}" class="w-full h-full object-cover">
                                {% else %}
                                <span class="text-xs text-slate-500">{{ profile.user.username|slice:":1" }}</span>
                                {% endif %}
                            </div>
                            <span class="font-medium text-slate-200 group-hover:text-white">{{ profile.user.username
                                }}</span>
                            {% if user == profile.user %}
                            <span
                                class="text-[10px] bg-emerald-500/20 text-emerald-400 px-1.5 py-0.5 rounded ml-2 border border-emerald-500/20">YOU</span>
                            {% endif %}
                        </div>
                    </td>
                    <td class="px-6 py-4 text-right font-bold text-emerald-500">
                        {{ profile.total_points }}
                    </td>
                    <td class="px-6 py-4 text-right hidden md:table-cell text-xs text-slate-600">
                        Last: {{ profile.last_solved|date:"M d" }}
                    </td>
                </tr>
                {% endif %}
                {% empty %}
                <tr>
                    <td colspan="4" class="px-6 py-12 text-center text-slate-500">
                        NO_DATA_AVAILABLE
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <!-- Pagination -->
        {% if is_paginated %}
        <div class="border-t border-white/5 p-4 flex justify-between items-center bg-black/20">
            {% if page_obj.has_previous %}
            <a href="?page={{ page_obj.previous_page_number }}"
                class="text-slate-400 hover:text-white font-mono text-xs flex items-center gap-2">
                <i class="fas fa-chevron-left"></i> PREV
            </a>
            {% else %}
            <span class="text-slate-700 font-mono text-xs flex items-center gap-2 cursor-not-allowed">
                <i class="fas fa-chevron-left"></i> PREV
            </span>
            {% endif %}

            <span class="text-slate-500 font-mono text-xs">PAGE {{ page_obj.number }}</span>

            {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}"
                class="text-slate-400 hover:text-white font-mono text-xs flex items-center gap-2">
                NEXT <i class="fas fa-chevron-right"></i>
            </a>
            {% else %}
            <span class="text-slate-700 font-mono text-xs flex items-center gap-2 cursor-not-allowed">
                NEXT <i class="fas fa-chevron-right"></i>
            </span>
            {% endif %}
        </div>
        {% endif %}
    </div>

</div>
{% endblock %}