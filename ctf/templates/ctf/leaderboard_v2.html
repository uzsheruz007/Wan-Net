{% extends 'ctf/ctf_home.html' %}

{% block title %}ELITA REYTING // ENG ZO'R AGENTLAR{% endblock %}

{% block content %}
<style>
    :root {
        --neon-gold: #f59e0b;
        --neon-silver: #94a3b8;
        --neon-bronze: #d97706;
        --neon-emerald: #10b981;
        --neon-cyan: #06b6d4;
    }

    /* Entry Animations */
    @keyframes fadeInUp {
        from { opacity: 0; transform: translateY(30px); }
        to { opacity: 1; transform: translateY(0); }
    }

    @keyframes podiumRise {
        from { opacity: 0; transform: translateY(100px) scale(0.9); }
        to { opacity: 1; transform: translateY(0) scale(1); }
    }

    .animate-entry { animation: fadeInUp 0.6s cubic-bezier(0.2, 0.8, 0.2, 1) backwards; }
    .animate-podium { animation: podiumRise 0.8s cubic-bezier(0.34, 1.56, 0.64, 1) backwards; }
    
    .delay-100 { animation-delay: 100ms; }
    .delay-200 { animation-delay: 200ms; }
    .delay-300 { animation-delay: 300ms; }
    .delay-500 { animation-delay: 500ms; }

    /* Hero/Podium Cards */
    .hero-card {
        backdrop-filter: blur(12px);
        border: 1px solid rgba(255, 255, 255, 0.05);
        border-radius: 16px;
        padding: 2rem;
        text-align: center;
        position: relative;
        transition: transform 0.4s ease, box-shadow 0.4s ease, border-color 0.4s ease;
        overflow: hidden;
    }

    .hero-card::before {
        content: '';
        position: absolute;
        inset: 0;
        background: linear-gradient(to bottom, rgba(255,255,255,0.02), transparent);
        pointer-events: none;
    }

    .hero-card:hover {
        transform: translateY(-10px);
        box-shadow: 0 20px 40px -10px rgba(0,0,0,0.5);
    }

    /* Rank Specific Styles */
    .card-rank-1 {
        border-top: 3px solid rgba(16, 185, 129, 0.1);
        box-shadow: 0 0 30px rgba(245, 158, 11, 0.1);
        z-index: 10;
        transform: scale(1.05);
    }
    .card-rank-1:hover {
        border-color: #ffd700; /* Bright Gold */
        box-shadow: 0 0 60px rgba(255, 215, 0, 0.3);
        transform: scale(1.05) translateY(-10px);
    }
    
    .card-rank-2 { border-top: 3px solid rgba(16, 185, 129, 0.1); }
    .card-rank-2:hover {
        border-color: var(--neon-silver);
        box-shadow: 0 0 50px rgba(148, 163, 184, 0.2);
        transform: translateY(-10px);
    }

    .card-rank-3 { border-top: 3px solid rgba(16, 185, 129, 0.1); order: 3; }
    .card-rank-3:hover {
        border-color: #d97706;
        box-shadow: 0 0 50px rgba(217, 119, 6, 0.2);
        transform: translateY(-10px);
    }
    
    /* Mobile Order Fix */
    @media (min-width: 768px) {
        .card-rank-1 { order: 2; margin-bottom: 2rem; }
        .card-rank-2 { margin-top: 2rem; }
        .card-rank-3 { margin-top: 4rem; }
    }

    .hero-avatar-box {
        position: relative;
        width: 100px;
        height: 100px;
        margin: 0 auto 1.5rem;
    }

    .hero-avatar {
        width: 100%;
        height: 100%;
        border-radius: 12px;
        object-fit: cover;
        box-shadow: 0 10px 20px rgba(0,0,0,0.3);
        border: 2px solid rgba(255,255,255,0.1);
    }

    /* Table Styling */
    .cyber-table-wrapper {
        background: rgb(131 211 185 / 6%);
        border: 1px solid rgba(255, 255, 255, 0.05);
        border-radius: 12px;
        overflow: hidden;
        backdrop-filter: blur(10px);
        box-shadow: 0 20px 40px rgba(0,0,0,0.2);
    }

    .cyber-row {
        display: grid;
        grid-template-columns: 80px 1fr 150px 150px; /* Fixed Layout */
        padding: 16px;
        align-items: center;
        border-bottom: 1px solid rgba(255, 255, 255, 0.03);
        transition: all 0.2s ease;
    }
    
    @media (max-width: 768px) {
        .cyber-row {
            grid-template-columns: 50px 1fr 80px;
            gap: 10px;
        }
        .hide-mobile { display: none; }
        .hide-mobile-headers { display: none; }
    }

    .cyber-row:hover {
        background: rgba(255, 255, 255, 0.03);
        transform: scale(1.005);
        box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        border-color: rgba(255, 255, 255, 0.1);
        z-index: 5;
        position: relative;
    }

    .rank-num {
        font-family: 'Orbitron', sans-serif;
        font-weight: bold;
        color: #475569;
        font-size: 1.2rem;
    }
    .cyber-row:hover .rank-num { color: #fff; }

    /* Current User Highlight */
    .user-highlight {
        background: rgba(16, 185, 129, 0.05) !important;
        border-left: 3px solid var(--neon-emerald);
    }
</style>

<div class="max-w-7xl mx-auto px-4 py-20 min-h-screen">
    
    <!-- HEADER -->
    <div class="text-center mb-20 relative animate-entry">
        <h1 class="text-6xl md:text-8xl font-black text-transparent bg-clip-text bg-gradient-to-b from-white to-slate-800 tracking-tighter drop-shadow-2xl" style="font-family: 'Orbitron';">
            LEADERBOARD
        </h1>
        <div class="text-emerald-400 font-mono tracking-[0.5em] text-xs md:text-sm mt-4 opacity-80 uppercase">
            // Global Elite Rankings //
        </div>
    </div>

    {% if is_first_page and podium %}
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-24 max-w-5xl mx-auto items-end">
        
        <!-- RANK 2 -->
        {% if podium|length >= 2 %}
            {% with p=podium.1 %}
            <div class="hero-card card-rank-2 animate-podium delay-200">
                <div class="hero-avatar-box">
                    {% if p.avatar %}<img src="{{ p.avatar.url }}" class="hero-avatar">{% else %}<div class="hero-avatar bg-slate-800 grid place-items-center text-3xl font-bold text-white">{{ p.user.username.0 }}</div>{% endif %}
                    <div class="absolute -bottom-3 left-1/2 -translate-x-1/2 bg-slate-800 border border-slate-600 text-slate-300 text-[10px] px-2 py-0.5 rounded font-mono">RANK 02</div>
                </div>
                <div class="text-xl font-bold text-white font-mono truncate px-2">{{ p.user.username }}</div>
                <div class="mt-2 text-3xl font-black font-display text-slate-200">{{ p.total_points }}</div>
                <div class="text-[10px] uppercase tracking-widest mt-1 opacity-50 text-slate-400">Points</div>
            </div>
            {% endwith %}
        {% endif %}

        <!-- RANK 1 -->
        {% if podium|length >= 1 %}
            {% with p=podium.0 %}
            <div class="hero-card card-rank-1 animate-podium">
                <div class="absolute top-0 right-0 p-4 opacity-20"><i class="fas fa-trophy text-6xl text-yellow-500"></i></div>
                <div class="hero-avatar-box w-32 h-32">
                    {% if p.avatar %}<img src="{{ p.avatar.url }}" class="hero-avatar border-yellow-500/50">{% else %}<div class="hero-avatar bg-slate-800 grid place-items-center text-5xl font-bold text-white border-yellow-500/50">{{ p.user.username.0 }}</div>{% endif %}
                    <i class="fas fa-crown absolute -top-6 left-1/2 -translate-x-1/2 text-5xl text-yellow-400 drop-shadow-[0_0_15px_rgba(250,204,21,0.6)] animate-bounce" style="animation-duration: 3s;"></i>
                </div>
                <div class="text-2xl font-bold text-white font-mono mt-4">{{ p.user.username }}</div>
                <div class="text-5xl font-black text-white mt-2 drop-shadow-[0_0_10px_rgba(255,255,255,0.3)]">{{ p.total_points }}</div>
                <div class="text-sm uppercase tracking-widest text-yellow-400 mt-2 font-bold">TOP OPERATIVE</div>
            </div>
            {% endwith %}
        {% endif %}

        <!-- RANK 3 -->
        {% if podium|length >= 3 %}
            {% with p=podium.2 %}
            <div class="hero-card card-rank-3 animate-podium delay-300">
                <div class="hero-avatar-box">
                    {% if p.avatar %}<img src="{{ p.avatar.url }}" class="hero-avatar">{% else %}<div class="hero-avatar bg-slate-800 grid place-items-center text-3xl font-bold text-white">{{ p.user.username.0 }}</div>{% endif %}
                    <div class="absolute -bottom-3 left-1/2 -translate-x-1/2 bg-slate-800 border border-slate-600 text-slate-300 text-[10px] px-2 py-0.5 rounded font-mono">RANK 03</div>
                </div>
                <div class="text-xl font-bold text-white font-mono truncate px-2">{{ p.user.username }}</div>
                <div class="mt-2 text-3xl font-black font-display text-slate-200">{{ p.total_points }}</div>
                <div class="text-[10px] uppercase tracking-widest mt-1 opacity-50 text-slate-400">Points</div>
            </div>
            {% endwith %}
        {% endif %}

    </div>
    {% endif %}

    <!-- DATA LIST -->
    <div class="cyber-table-wrapper max-w-5xl mx-auto animate-entry delay-500">
        <!-- Headers -->
        <div class="grid grid-cols-[80px_1fr_150px_150px] p-4 bg-white/5 text-xs text-slate-500 font-mono tracking-widest uppercase border-b border-white/10 hide-mobile-headers">
            <div class="text-center">#</div>
            <div>OPERATIVE</div>
            <div class="text-right">SCORE</div>
            <div class="text-right">LAST ACTIVE</div>
        </div>

        {% for profile in page_obj %}
            {% if not is_first_page or forloop.counter > 3 %}
            <div class="cyber-row group {% if user == profile.user %}user-highlight{% endif %}">
                <!-- Rank -->
                <div class="rank-num text-center group-hover:text-emerald-400 transition-colors">
                    {{ profile.rank }}
                </div>

                <!-- User -->
                <div class="flex items-center gap-4">
                    <div class="w-10 h-10 rounded-lg bg-slate-800 overflow-hidden border border-white/10 group-hover:border-emerald-400 transition-colors relative">
                        {% if profile.avatar %}
                        <img src="{{ profile.avatar.url }}" class="w-full h-full object-cover">
                        {% else %}
                        <div class="w-full h-full grid place-items-center text-slate-500 font-bold font-mono">
                            {{ profile.user.username.0 }}
                        </div>
                        {% endif %}
                    </div>
                    <div>
                        <div class="font-bold text-slate-200 group-hover:text-emerald-400 transition-colors flex items-center gap-2">
                            {{ profile.user.username }}
                            {% if user == profile.user %}
                            <span class="px-1.5 py-0.5 rounded bg-emerald-500/20 text-emerald-400 text-[10px] border border-emerald-500/20">YOU</span>
                            {% endif %}
                        </div>
                        <div class="text-[10px] text-slate-600 font-mono group-hover:text-slate-500">Level {{ profile.level|default:"1" }}</div>
                    </div>
                </div>

                <!-- Score -->
                <div class="text-right font-mono font-bold text-xl text-slate-400 group-hover:text-white transition-colors">
                    {{ profile.total_points }}
                </div>

                <!-- Active -->
                <div class="text-right text-xs text-slate-600 font-mono hide-mobile group-hover:text-slate-500">
                    {{ profile.last_solved|timesince }} ago
                </div>
            </div>
            {% endif %}
        {% empty %}
            <div class="p-24 text-center text-slate-600 font-mono">
                <i class="fas fa-database text-4xl mb-4 opacity-50"></i><br>
                NO DATA FOUND
            </div>
        {% endfor %}

        <!-- PAGINATION -->
        {% if is_paginated and page_obj.paginator.num_pages > 1 %}
        <div class="p-6 flex justify-center gap-3 border-t border-white/10 bg-black/20">
             {% if page_obj.has_previous %}
             <a href="?page={{ page_obj.previous_page_number }}" class="px-5 py-2 bg-white/5 hover:bg-emerald-500/10 border border-white/10 rounded text-slate-400 hover:text-emerald-400 font-mono text-xs transition-colors">
                <i class="fas fa-chevron-left mr-1"></i> PREV
             </a>
             {% endif %}
             
             <span class="px-5 py-2 text-emerald-500 font-mono text-xs border border-emerald-500/20 bg-emerald-500/5 rounded font-bold">
                 PAGE {{ page_obj.number }}
             </span>

             {% if page_obj.has_next %}
             <a href="?page={{ page_obj.next_page_number }}" class="px-5 py-2 bg-white/5 hover:bg-emerald-500/10 border border-white/10 rounded text-slate-400 hover:text-emerald-400 font-mono text-xs transition-colors">
                NEXT <i class="fas fa-chevron-right ml-1"></i>
             </a>
             {% endif %}
        </div>
        {% endif %}
    </div>

</div>
{% endblock %}