{% extends 'ctf/ctf_home.html' %}
{% load static %}

{% block title %}CTF Arena // Wan-Net{% endblock %}

{% block content %}
<style>
    /* Category Filters */
    .cat-btn {
        background: transparent;
        border: 1px solid rgba(255, 255, 255, 0.1);
        color: #94a3b8;
        padding: 8px 16px;
        font-family: 'JetBrains Mono', monospace;
        font-size: 0.8rem;
        cursor: pointer;
        transition: all 0.3s;
        clip-path: polygon(10px 0, 100% 0, 100% calc(100% - 10px), calc(100% - 10px) 100%, 0 100%, 0 10px);
    }

    .cat-btn:hover,
    .cat-btn.active {
        background: rgba(16, 185, 129, 0.1);
        border-color: #10b981;
        color: #fff;
        text-shadow: 0 0 5px rgba(16, 185, 129, 0.5);
    }

    /* Challenge Card */
    .chal-card {
        background: #0a0c10;
        border: 1px solid rgba(255, 255, 255, 0.05);
        position: relative;
        overflow: hidden;
        transition: 0.3s;
        display: flex;
        flex-direction: column;
    }

    .chal-card:hover {
        border-color: rgba(6, 182, 212, 0.5);
        box-shadow: 0 0 20px rgba(6, 182, 212, 0.1);
        transform: translateY(-5px);
    }

    .chal-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 2px;
        background: linear-gradient(90deg, transparent, #06b6d4, transparent);
        transform: scaleX(0);
        transition: 0.4s;
    }

    .chal-card:hover::before {
        transform: scaleX(1);
    }

    .category-badge {
        position: absolute;
        top: 10px;
        right: 10px;
        font-size: 0.65rem;
        font-family: monospace;
        text-transform: uppercase;
        padding: 2px 6px;
        border: 1px solid;
        border-radius: 2px;
    }

    .cat-crypto {
        color: #d8b4fe;
        border-color: #a855f7;
        background: rgba(168, 85, 247, 0.1);
    }

    .cat-web {
        color: #67e8f9;
        border-color: #06b6d4;
        background: rgba(6, 182, 212, 0.1);
    }

    .cat-osint {
        color: #fcd34d;
        border-color: #f59e0b;
        background: rgba(245, 158, 11, 0.1);
    }

    .cat-forensics {
        color: #86efac;
        border-color: #10b981;
        background: rgba(16, 185, 129, 0.1);
    }

    .cat-default {
        color: #94a3b8;
        border-color: #475569;
    }

    /* Difficulty Bar */
    .diff-dots {
        display: flex;
        gap: 2px;
    }

    .diff-dot {
        width: 6px;
        height: 6px;
        background: #333;
        border-radius: 1px;
    }

    .diff-easy .d1 {
        background: #10b981;
    }

    .diff-medium .d1,
    .diff-medium .d2 {
        background: #facc15;
    }

    .diff-hard .d1,
    .diff-hard .d2,
    .diff-hard .d3 {
        background: #ef4444;
    }
</style>

<main class="flex-grow container mx-auto px-4 py-8 max-w-7xl pt-32 min-h-screen">

    <div class="flex flex-col md:flex-row md:items-end justify-between mb-12 gap-6">
        <div>
            <h1 class="text-4xl font-bold text-white font-display mb-2">
                MISSION <span
                    class="text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-emerald-400">CONTROL</span>
            </h1>
            <p class="text-slate-500 font-mono text-sm leading-relaxed">
                > Select a mission file to begin decryption.<br>
                > Unauthorized access will be logged.
            </p>
        </div>

        <!-- Filters -->
        <div class="flex flex-wrap gap-2">
            <button class="cat-btn active">ALL</button>
            <button class="cat-btn">CRYPTO</button>
            <button class="cat-btn">WEB</button>
            <button class="cat-btn">OSINT</button>
            <button class="cat-btn">FORENSICS</button>
        </div>
    </div>

    <!-- Challenges Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        {% for challenge in challenges %}
        <a href="{% url 'challenge_detail' challenge.id %}" class="chal-card p-6 h-full group">

            <span
                class="category-badge 
                {% if challenge.category == 'Cryptography' %}cat-crypto{% elif challenge.category == 'Web' %}cat-web{% elif challenge.category == 'OSINT' %}cat-osint{% elif challenge.category == 'Forensics' %}cat-forensics{% else %}cat-default{% endif %}">
                {{ challenge.category|default:"GENERAL" }}
            </span>

            <div class="mb-4 mt-2">
                <i class="fas fa-folder text-4xl text-slate-700 group-hover:text-cyan-500 transition-colors mb-4"></i>
                <h3 class="text-lg font-bold text-white group-hover:text-cyan-400 transition-colors line-clamp-1">
                    {{ challenge.title }}
                </h3>
            </div>

            <div class="mt-auto pt-4 border-t border-white/5 flex items-center justify-between">
                <span class="text-emerald-500 font-mono font-bold">{{ challenge.points }} PTS</span>

                <!-- Difficulty Indicator -->
                <div
                    class="diff-dots 
                    {% if challenge.difficulty == 'Easy' %}diff-easy{% elif challenge.difficulty == 'Medium' %}diff-medium{% else %}diff-hard{% endif %}">
                    <div class="diff-dot d1"></div>
                    <div class="diff-dot d2"></div>
                    <div class="diff-dot d3"></div>
                </div>
            </div>

            {% if challenge in solved_challenges %}
            <div
                class="absolute inset-0 bg-black/60 backdrop-blur-[1px] flex items-center justify-center border-2 border-emerald-500/50">
                <div
                    class="text-emerald-500 font-bold font-mono text-xl rotate-[-15deg] border-4 border-emerald-500 px-4 py-2 rounded opacity-80">
                    SOLVED
                </div>
            </div>
            {% endif %}
        </a>
        {% empty %}
        <div class="col-span-full py-20 text-center">
            <p class="text-slate-600 font-mono">> No missions available in the database.</p>
        </div>
        {% endfor %}
    </div>

</main>
{% endblock %}